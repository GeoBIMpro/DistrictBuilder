#!/bin/bash
set -e

if [[ -n "${DB_DEBUG}" ]]; then
    set -x
fi

function usage() {

    echo -n \
"Usage: $(basename "$0")
Setup project containers and database.
"
}

function build_containers() {
    echo "Building containers"
    docker-compose build
}

function run_migrations() {
    echo "Running migrations"
    docker-compose \
        exec -T django ./manage.py migrate
}

if [ "${BASH_SOURCE[0]}" = "${0}" ]
then
    if [ "${1:-}" = "--help" ]
    then
        usage
    else
        build_containers
        docker-compose up -d postgres django
        run_migrations
    fi
    exit
fi
